@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model IEnumerable<Du_An_One.Models.SANPHAM>
@{
    ViewData["Title"] = "ToolFindProduct";
    Layout = "~/Views/Shared/_TempLayout.cshtml";
}
@{    var numProduct = 0;
    var products = Model.ToList(); // Convert the model to a list for easier indexing in JavaScript.
    var productJson = System.Text.Json.JsonSerializer.Serialize(products); // Serialize the list to JSON.
}

<main class="py-8">
    <div class="flex justify-between items-center mb-4">
        <h1 class="text-2xl font-bold">Tìm kiếm</h1>
        <button id="filterButton" class="bg-secondary text-secondary-foreground px-4 py-2 rounded hover:bg-secondary/80" style="color:white;">
            Filter
        </button>
    </div>
    <div id="filterBoard" class="hidden bg-card p-4 rounded shadow-md mb-4">
        <!-- Begin Nav Negavation to Type Product -->
        <div class="container px-5">
            <form id="filterForm" method="get" asp-action="ShowListProductsByFirm">
                <nav class="row justify-content-around text-center">
                    <div class="col-md-2">
                        <input type="checkbox" id="tuft" name="firms" value="TUFT">
                        <label for="tuft">TUFT</label>
                    </div>
                    <div class="col-md-2">
                        <input type="checkbox" id="adius" name="firms" value="Adius">
                        <label for="adius">Adius</label>
                    </div>
                    <div class="col-md-2">
                        <input type="checkbox" id="surius" name="firms" value="Surius">
                        <label for="surius">Surius</label>
                    </div>
                    <div class="col-md-2">
                        <input type="checkbox" id="adidas" name="firms" value="Adidas">
                        <label for="adidas">Adidas</label>
                    </div>
                </nav>
                <nav class="row justify-content-around text-center">
                    <select name="quantitySold" class="bg-input text-primary-foreground dark:text-primary p-2 rounded ml-2">
                        <option value="" selected>Select Quantity Sold</option>
                        <option value="1-50">1 - 50</option>
                        <option value="51-100">51 - 100</option>
                        <option value="101-200">101 - 200</option>
                        <option value="201+">201+</option>
                    </select>
                    <select name="price" class="bg-input text-primary-foreground dark:text-primary p-2 rounded ml-2">
                        <option value="" selected>Select Product Price</option>
                        <option value="0-100000">0 - 100.000 VND</option>
                        <option value="100001-200000">100.001 - 200.000 VND</option>
                        <option value="200001-500000">200.001 - 500.000 VND</option>
                        <option value="500001+">500.001 VND+</option>
                    </select>

                    <input type="text"
                           name="searchText"
                           placeholder="Search Product Info"
                           class="bg-input text-primary-foreground dark:text-primary p-2 rounded ml-2" />
                    <button type="submit" class="bg-primary text-primary-foreground p-2 rounded-lg ml-2 hover:bg-primary/80">
                        Search
                    </button>
                </nav>
            </form>
        </div>
        <!-- End Nav Negavation to Type Product -->
    </div>
    <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @foreach (var oneProduct in Model)
        {
            if (numProduct++ == 3)
            {
                break;
            }
            var img = oneProduct.HinhAnh.Length < 10 ? "../img/productImage/default.jpg" : "../img/productImage/" + oneProduct.HinhAnh;

            <div class="bg-card p-4 rounded shadow-md">
                <img data-imgbigurl="@Url.Content(img)" src="@Url.Content(img)" alt="@oneProduct.TenSP" onerror="this.src='https://cdn.leonardo.ai/users/95219c13-f990-4541-addb-090c7c03d405/generations/77ed9f7c-fb62-4f73-a9de-17ddc965e777/Default_create_an_image_with_the_main_color_being_gray_and_whi_3.jpg'" class="w-full h-96 object-cover mb-4" />
                <h2 class="text-lg font-semibold">@oneProduct.TenSP</h2>
                <p class="text-muted-foreground">$@oneProduct.DonGiaBan</p>
                <a asp-action="ShowDetailProduct" asp-route-idProduct="@oneProduct.MaSP" class="btn">Chi tiết</a>
            </div>
        }
    </div>
    <div class="text-center mt-8">
        <p id="hetSanPham" style="display:none;">Sản phẩm tìm kiếm đã hết</p>

        <button id="showMoreButton" class="bg-primary text-primary-foreground px-6 py-2 rounded hover:bg-primary/80" style="color:white;">
            Show more
        </button>
    </div>
</main>
@section Scripts {
    <script>
        document.getElementById("filterButton").addEventListener("click", function () {
            const filterBoard = document.getElementById("filterBoard");
            filterBoard.classList.toggle("hidden");
        });

        const products = @Html.Raw(productJson); // Inject the serialized products list
        var numProduct = @numProduct;
        document.getElementById("showMoreButton").addEventListener("click", function () {
            const productGrid = document.getElementById("productGrid");
            const newItems = [];

            for (let num = numProduct; num < numProduct + 3; num++) {
                if (num >= products.length) {
                    this.style.display = 'none';
                    document.getElementById('hetSanPham').style.display = '';
                    break;
                } else {
                    const img = products[num].HinhAnh.length < 10 ? "../img/productImage/default.jpg" : "../img/productImage/" + products[num].HinhAnh;

                    newItems.push({
                        id: products[num].MaSP,
                        imgSrc: img,
                        alt: products[num].TenSP,
                        title: products[num].TenSP,
                        price: products[num].DonGiaBan,
                    });
                }
            }

            numProduct += newItems.length;
            newItems.forEach((item) => {
                const productCard = document.createElement("div");
                productCard.className = "bg-card p-4 rounded shadow-md";
                productCard.innerHTML = `
                            <img src="${item.imgSrc}" alt="${item.alt}"  class="w-full h-96 object-cover mb-4" >
                            <h2 class="text-lg font-semibold">${item.title}</h2>
                            <p class="text-muted-foreground">$${item.price}</p>
                                    <a asp-action="ShowDetailProduct" asp-route-idProduct="${item.MaSP}" class="btn">Chi tiết</a>
                        `;
                productGrid.appendChild(productCard);
            });
        });
    </script>
}
